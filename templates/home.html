{% extends "base.html" %}
{% block title %}Home @ Furl{% endblock %}
{% block content %}
<div class="hero">
    <div class="hero-text">
        <h1>Furl URL Shrinker</h1>
        <p>Shorten long URLs easily and quickly with Furl!</p>
        <a href="#shorten" class="btn-animate">Get Started</a>
    </div>
</div>

<form class="url-form" action="#" method="POST" id="shorten">
    <label for="url">Enter the EndlessURL:</label>
    <input type="url" name="url" id="url"
           placeholder="https://www.youtube.com"
           pattern="https?://.+"
           size="50"
           required>
    <br/><br/>
    <label for="name">Name:</label>
    <input type="text" name="name" id="name" size="50">
    <br/><br/>
    <input type="submit" value="Shrink" class="btn-animate">
</form>

{% if furl %}
    <p>Shortened URL: <a id="link" href="/{{ furl }}" target="_blank">{{ furl }}</a></p>
{% endif %}

<h2>Your Furls:</h2>
<table border="1" class="furl-table">
    <thead>
        <tr>
            <th>Name</th>
            <th>Furl</th>
            <th>URL</th>
            <th>Count</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for furl, info in furls.items() %}
        <tr>
            <td>{{ info[0] }}</td>
            <td class="url">{{ furl }}</td>
            <td>{{ info[1] }}</td>
            <td>{{ info[2] }}</td>
            <td>
                <button class="btn-animate" onclick="copyToClipboard('{{ furl }}')">Copy</button>
                <form action="{{ url_for('delete_furl', furl=furl) }}" method="POST" style="display:inline;">
                    <input type="submit" value="Delete" class="btn-animate">
                </form>
                {% if info[3] %}
                <form action="{{ url_for('deactivate_furl', furl=furl) }}" method="POST" style="display:inline;">
                    <input type="submit" value="Deactivate" class="btn-animate">
                </form>
                {% else %}
                <form action="{{ url_for('activate_furl', furl=furl) }}" method="POST" style="display:inline;">
                    <input type="submit" value="Activate" class="btn-animate">
                </form>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script>
async function copyToClipboard(furl) {
    try {
        await navigator.clipboard.writeText(location.protocol + '//' + location.host + '/' + furl);
        alert('URL copied to clipboard');
    } catch(err) {
        console.error('Could not copy text: ', err);
    }
}
</script>
{% endblock %}
